<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Mrs. McAllister</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <div class="container-header">
            <div class="difficulty-select">
                <label for="difficulty">Difficulty:</label>
                <span id="current-difficulty" class="difficulty-{{ difficulty }}">{{ difficulty|capitalize }}</span>
                <select name="difficulty" id="difficulty" style="display:none;">
                    <option value="easy" {% if difficulty == 'easy' %}selected{% endif %}>Easy</option>
                    <option value="medium" {% if difficulty == 'medium' %}selected{% endif %}>Medium</option>
                    <option value="hard" {% if difficulty == 'hard' %}selected{% endif %}>Hard</option>
                </select>
            </div>
            <!-- User info removed: no authentication features -->
        </div>
        <br>
        <h1>Mrs. McAllister's Math Practice</h1>
        <h3 id="score">Score: {{ score }}</h3>

        {% if result %}
        <h2>{{ result }}</h2>
        {% endif %}

        <form method="post" id="math-form">
            <p>Solve: <strong>{{ question }}</strong></p>
            <input type="text" name="answer" placeholder="Enter answer here..." required>
            <input type="hidden" name="correct_answer" value="{{ answer }}">
            <button type="submit">Submit</button>
            <button type="button" id="skip-btn">Skip</button>
        </form>
    </div>

    <script>
         document.addEventListener('DOMContentLoaded', function() {
             const form = document.getElementById('math-form');
             const skipBtn = document.getElementById('skip-btn');
             const scoreElem = document.getElementById('score');
             const difficultySelect = document.getElementById('difficulty');

             form.addEventListener('submit', function(e) {
                 e.preventDefault();
                 const formData = new FormData(form);
                 formData.set('difficulty', difficultySelect.value);
                 fetch('/', {
                     method: 'POST',
                     body: formData,
                     headers: {
                         'X-Requested-With': 'XMLHttpRequest'
                     }
                 })
                 .then(response => response.json())
                 .then(data => {
                     document.querySelector('h2')?.remove();
                     if (data.result) {
                         const resultElem = document.createElement('h2');
                         resultElem.textContent = data.result;
                         if (data.result.startsWith('Correct')) {
                             resultElem.classList.add('correct');
                         } else {
                             resultElem.classList.add('incorrect');
                         }
                         form.parentNode.insertBefore(resultElem, form);
                     }
                     form.querySelector('strong').textContent = data.question;
                     form.querySelector('input[name="correct_answer"]').value = data.answer;
                     form.querySelector('input[name="answer"]').value = '';
                     if (scoreElem && typeof data.score !== 'undefined') {
                         scoreElem.textContent = 'Score: ' + data.score;
                     }
                     if (data.difficulty) {
                         const diffElem = document.getElementById('current-difficulty');
                         diffElem.textContent = data.difficulty.charAt(0).toUpperCase() + data.difficulty.slice(1);
                         diffElem.className = 'difficulty-' + data.difficulty;
                     }
                 });
             });

             skipBtn.addEventListener('click', function() {
                 const formData = new FormData();
                 formData.set('difficulty', difficultySelect.value);
                 fetch('/skip', {
                     method: 'POST',
                     body: formData,
                     headers: {
                         'X-Requested-With': 'XMLHttpRequest'
                     }
                 })
                 .then(response => response.json())
                 .then(data => {
                     document.querySelector('h2')?.remove();
                     form.querySelector('strong').textContent = data.question;
                     form.querySelector('input[name="correct_answer"]').value = data.answer;
                     form.querySelector('input[name="answer"]').value = '';
                     if (scoreElem && typeof data.score !== 'undefined') {
                         scoreElem.textContent = 'Score: ' + data.score;
                     }
                 });
             });

             difficultySelect.addEventListener('change', function() {
                 const formData = new FormData();
                 formData.set('difficulty', difficultySelect.value);
                 fetch('/skip', {
                     method: 'POST',
                     body: formData,
                     headers: {
                         'X-Requested-With': 'XMLHttpRequest'
                     }
                 })
                 .then(response => response.json())
                 .then(data => {
                     document.querySelector('h2')?.remove();
                     form.querySelector('strong').textContent = data.question;
                     form.querySelector('input[name="correct_answer"]').value = data.answer;
                     form.querySelector('input[name="answer"]').value = '';
                     if (scoreElem && typeof data.score !== 'undefined') {
                         scoreElem.textContent = 'Score: ' + data.score;
                     }
                 });
             });
         });
    </script>
    </body>
    </html>
