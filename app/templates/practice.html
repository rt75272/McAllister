<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
<div class="container">
    <h2>Math Practice</h2>
    <p>Hello, {{ username }}! Solve the following:</p>
    <form id="practice-form">
        <input type="hidden" id="question" name="question" value="{{ question }}">
        <label id="question-label">{{ question }}</label><br>
        <input type="text" id="answer" name="answer" required>
        <input type="submit" value="Submit">
    </form>
    <p>Current Score: <span id="score">{{ score }}</span>
        <button id="reset-score-btn" type="button">Reset</button>
    </p>
    <p>Daily Score: <span id="daily_score">{{ current_user.daily_score }}</span></p>
    <p>Total Score: <span id="total_score">{{ current_user.total_score }}</span></p>
    <p class="feedback{% if feedback_type %} {{ feedback_type }}{% endif %}" id="feedback">{% if feedback %}{{ feedback }}{% endif %}</p>
    <a href="{{ url_for('dashboard') }}">Back to Dashboard</a>
</div>

<script>
document.getElementById('practice-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    const question = document.getElementById('question').value;
    const answer = document.getElementById('answer').value;
    const res = await fetch("/api/practice", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({ question, answer })
    });
    const data = await res.json();
    document.getElementById('question').value = data.question;
    document.getElementById('question-label').textContent = data.question;
    document.getElementById('answer').value = "";
    document.getElementById('score').textContent = data.score;
    if (data.daily_score !== undefined) {
        document.getElementById('daily_score').textContent = data.daily_score;
    }
    if (data.total_score !== undefined) {
        document.getElementById('total_score').textContent = data.total_score;
    }
    const feedbackEl = document.getElementById('feedback');
    feedbackEl.textContent = data.feedback;
    feedbackEl.classList.remove('correct', 'incorrect');
    if (data.feedback_type) {
        feedbackEl.classList.add(data.feedback_type);
    }
});
    // AJAX reset current score
    const resetBtn = document.getElementById('reset-score-btn');
    if (resetBtn) {
        resetBtn.addEventListener('click', async function() {
            const res = await fetch("{{ url_for('reset_current_score') }}", {
                method: "POST"
            });
            if (res.ok) {
                document.getElementById('score').textContent = "0";
            }
        });
    }
</script>
